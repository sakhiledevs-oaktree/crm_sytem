<style>
/* Container that locks the scrollbar to the screen */
.table-responsive {
    max-height: 70vh; /* Keeps the scroller visible on the screen */
    overflow: auto;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    position: relative;
}

/* The Blue Scroller Styling */
.table-responsive::-webkit-scrollbar {
    height: 12px; /* Horizontal scroller thickness */
    width: 8px;   /* Vertical scroller thickness */
}

.table-responsive::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 10px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #2563eb; /* Royal Blue */
    border-radius: 10px;
    border: 2px solid #f1f5f9; /* Creates a clean padding effect */
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #1d4ed8; /* Darker blue on hover */
}
</style>

<div class="table-responsive" style="overflow-x: auto; border-radius: 12px; border: 1px solid #e2e8f0; background: white; position: relative;">
    <table class="table" style="width: 100%; border-collapse: separate; border-spacing: 0; min-width: 1600px;"> 
            <thead>
                <tr style="background: #f8fafc;">
                    <th style="padding: 16px; position: sticky; left: 0; top: 0; background: #f8fafc; z-index: 45; width: 50px; border-bottom: 2px solid #e2e8f0;">#</th>
                    
                    <th style="padding: 16px; position: sticky; left: 50px; top: 0; background: #f8fafc; z-index: 45; width: 250px; border-bottom: 2px solid #e2e8f0;">Client Name</th>
                    
                    <th style="padding: 16px; position: sticky; left: 300px; top: 0; background: #f8fafc; z-index: 45; width: 200px; border-bottom: 2px solid #e2e8f0; border-right: 2px solid #e2e8f0;">Primary Contact</th>
                    
                    <th style="padding: 16px; position: sticky; top: 0; background: #f8fafc; z-index: 40; border-bottom: 2px solid #e2e8f0; white-space: nowrap; color: #64748b; font-size: 0.7rem; text-transform: uppercase;">Phone Number</th>
                    <th style="padding: 16px; position: sticky; top: 0; background: #f8fafc; z-index: 40; border-bottom: 2px solid #e2e8f0; white-space: nowrap; color: #64748b; font-size: 0.7rem; text-transform: uppercase;">Email Address</th>
                    <th style="padding: 16px; position: sticky; top: 0; background: #f8fafc; z-index: 40; border-bottom: 2px solid #e2e8f0; white-space: nowrap; color: #64748b; font-size: 0.7rem; text-transform: uppercase;">ID Number</th>
                    <th style="padding: 16px; position: sticky; top: 0; background: #f8fafc; z-index: 40; border-bottom: 2px solid #e2e8f0; white-space: nowrap; text-align: center; color: #64748b; font-size: 0.7rem; text-transform: uppercase;">Progress</th>
                    <th style="padding: 16px; position: sticky; top: 0; background: #f8fafc; z-index: 40; border-bottom: 2px solid #e2e8f0; white-space: nowrap; text-align: right; color: #64748b; font-size: 0.7rem; text-transform: uppercase;">Tier</th>
                    <th style="padding: 16px; position: sticky; top: 0; background: #f8fafc; z-index: 40; border-bottom: 2px solid #e2e8f0; white-space: nowrap; text-align: right; color: #64748b; font-size: 0.7rem; text-transform: uppercase;">WhatsApp</th>
                    <th style="padding: 16px; position: sticky; top: 0; background: #f8fafc; z-index: 40; border-bottom: 2px solid #e2e8f0; text-align: left; color: #64748b; font-size: 0.7rem; text-transform: uppercase;">Admin Comments</th>
                </tr>
            </thead>

        <tbody>
            {% for row in rows %}
            <tr class="table-row">
                
                <td style="padding: 16px; color: #94a3b8; position: sticky; left: 0; background: white; z-index: 10; font-size: 0.85rem; border-bottom: 1px solid #f1f5f9; white-space: nowrap;">{{ loop.index }}</td>
                
                <td style="padding: 16px; font-weight: 700; color: #1e293b; position: sticky; left: 50px; background: white; z-index: 10; border-bottom: 1px solid #f1f5f9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px;" title="{{ row.client }}">
                    <div style="display: flex; align-items: center;">
                        <span style="overflow: hidden; text-overflow: ellipsis;">{{ row.client }}</span>
                        {% if row.comment == 'Enriched' %}
                            <span class="badge-updated">Updated</span>
                        {% endif %}
                    </div>
                </td>

                <td style="padding: 16px; font-size: 0.9rem; color: #334155; position: sticky; left: 300px; background: white; z-index: 10; border-bottom: 1px solid #f1f5f9; white-space: nowrap; border-right: 2px solid #e2e8f0;">
                    {{ row.primary_contact if row.primary_contact else '-' }}
                </td>
                
                <td style="padding: 16px; font-size: 0.9rem; color: #475569; border-bottom: 1px solid #f1f5f9; white-space: nowrap;">{{ row.phone }}</td>
                
                <td style="padding: 16px; border-bottom: 1px solid #f1f5f9; white-space: nowrap;">
                    <span class="email-blue">{{ row.email }}</span>
                </td>
                
                <td style="padding: 16px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #64748b; border-bottom: 1px solid #f1f5f9; white-space: nowrap;">{{ row.id_number }}</td>
                
                <td onclick='openCandidateProfile("{{ row.email }}", "{{ row.client }}")'
                    style="padding: 16px; border-bottom: 1px solid #f1f5f9; white-space: nowrap; cursor: pointer;">
                    <div style="display: flex; gap: 4px; justify-content: center;">
                        {% for i in range(1, 7) %}
                            {% set is_done = row.completed_surveys and i in row.completed_surveys %}
                            <span style="width: 8px; height: 8px; border-radius: 50%; background: {{ '#ef4444' if is_done else '#e2e8f0' }}; display: inline-block;"></span>
                        {% endfor %}
                    </div>
                </td>

                <td style="padding: 16px; text-align: right; border-bottom: 1px solid #f1f5f9; white-space: nowrap;">
                    <span style="background: #f1f5f9; color: #475569; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; white-space: nowrap;">
                        {{ row.tier if row.tier else 'STANDARD' }}
                    </span>
                </td>

                <td style="padding: 16px; text-align: center; border-bottom: 1px solid #f1f5f9; white-space: nowrap;" onclick="event.stopPropagation()">
                    <button onclick="sendWhatsApp('{{ row.phone }}', '{{ row.client }}')" 
                        style="background: #25d366; color: white; border: none; padding: 6px 14px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; cursor: pointer;">
                        SEND
                    </button>
                </td>

                <td style="padding: 16px; border-bottom: 1px solid #f1f5f9; white-space: nowrap;" onclick="event.stopPropagation()">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <input type="text" 
                            id="comment-{{ row.id_number }}"
                            value="{{ row.admin_notes if row.admin_notes else '' }}" 
                            placeholder="Add note..."
                            style="border: 1px solid #e2e8f0; border-radius: 6px; padding: 6px 10px; font-size: 0.8rem; width: 220px; outline: none; transition: 0.2s;"
                            onfocus="this.style.borderColor='#2563eb'"
                            onblur="this.style.borderColor='#e2e8f0'">
                        
                        <button onclick="saveComment('{{ row.id_number }}', document.getElementById('comment-{{ row.id_number }}').value, this)" 
                            style="background: #2563eb; color: white; border: none; width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; flex-shrink: 0;"
                            title="Save Comment">
                            <svg style="width: 14px; height: 14px; fill: none; stroke: white; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round;" viewBox="0 0 24 24">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>